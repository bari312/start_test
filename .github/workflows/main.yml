name: LocalStack Service Test
on: [push, pull_request]

jobs:
  test_localstack_setup:
    runs-on: ubuntu-latest
    
    # ğŸš¨ LocalStackã‚’ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å®šç¾©
    services:
      localstack:
        image: localstack/localstack:latest
        ports:
          - 4566:4566
        env:
          # LocalStackãŒèµ·å‹•ã™ã‚‹ã¾ã§å¾…æ©Ÿã™ã‚‹æ™‚é–“ã‚’é•·ãè¨­å®š
          DEFAULT_REGION: us-east-1
          DOCKER_HOST: unix:///var/run/docker.sock
          # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’é•·ãè¨­å®š (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
          START_TIMEOUT: 60 
          
        # LocalStackã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã™ã‚‹ã¾ã§å¾…æ©Ÿã™ã‚‹ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
        options: >-
          --health-cmd "curl http://localhost:4566/ | grep 'LocalStack'"
          --health-interval 5s
          --health-timeout 5s
          --health-retries 10

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        
      # ğŸš¨ LocalStackã®ã‚«ã‚¹ã‚¿ãƒ èµ·å‹•ã‚¹ãƒ†ãƒƒãƒ—ã‚’å‰Šé™¤
      
      # ğŸš¨ ä»£ã‚ã‚Šã«ã€ã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•å®Œäº†ã‚’å¾…ã£ã¦ã‹ã‚‰å®Ÿè¡Œã•ã‚Œã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¿½åŠ 
      - name: Verify LocalStack Service is Up
        run: |
          curl http://localhost:4566/
          echo "LocalStack is now running as a managed service."

      # ... (TA-Lib ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã“ã“ã«æˆ»ã™) ...

      # 1. TA-Lib æœ¬ä½“ (Cè¨€èªãƒ©ã‚¤ãƒ–ãƒ©ãƒª) ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (å¤‰æ›´ãªã—)
      - name: Install TA-Lib from source
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential wget
          wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz
          tar -xzvf ta-lib-0.4.0-src.tar.gz
          cd ta-lib/
          ./configure --prefix=/usr
          make
          sudo make install
      
    
          
      - name: Just print a message
        run: echo "TA-Lib and LocalStack environment ready for use."
